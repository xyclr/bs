<%- include header %>
<body class=" pace-done">
<div class="pace  pace-inactive">
    <div class="pace-progress" data-progress-text="100%" data-progress="99"
         style="-webkit-transform: translate3d(100%, 0px, 0px); transform: translate3d(100%, 0px, 0px);">
        <div class="pace-progress-inner"></div>
    </div>
    <div class="pace-activity"></div>
</div>

<div id="wrapper">
    <%- include nav %>
    <div id="page-wrapper" class="gray-bg dashbard-1">
        <div class="row border-bottom">
            <nav class="navbar navbar-static-top" role="navigation" style="margin-bottom: 0">
                <div class="navbar-header">
                    <a class="navbar-minimalize minimalize-styl-2 btn btn-primary "
                       href="http://webapplayers.com/inspinia_admin-v2.1/#"><i class="fa fa-bars"></i> </a>

                    <form role="search" class="navbar-form-custom"
                          action="http://webapplayers.com/inspinia_admin-v2.1/search_results.html">
                        <div class="form-group">
                            <input type="text" placeholder="Search for something..." class="form-control"
                                   name="top-search" id="top-search">
                        </div>
                    </form>
                </div>
                <ul class="nav navbar-top-links navbar-right">
                    <li>
                        <span class="m-r-sm text-muted welcome-message">Welcome to INSPINIA+ Admin Theme.</span>
                    </li>
                    <li class="dropdown">
                        <a class="dropdown-toggle count-info" data-toggle="dropdown"
                           href="http://webapplayers.com/inspinia_admin-v2.1/#">
                            <i class="fa fa-envelope"></i> <span class="label label-warning">16</span>
                        </a>
                        <ul class="dropdown-menu dropdown-messages">
                            <li>
                                <div class="dropdown-messages-box">
                                    <a href="http://webapplayers.com/inspinia_admin-v2.1/profile.html"
                                       class="pull-left">
                                        <img alt="image" class="img-circle" src="../img/a7.jpg">
                                    </a>

                                    <div class="media-body">
                                        <small class="pull-right">46h ago</small>
                                        <strong>Mike Loreipsum</strong> started following <strong>Monica Smith</strong>.
                                        <br>
                                        <small class="text-muted">3 days ago at 7:58 pm - 10.06.2014</small>
                                    </div>
                                </div>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <div class="dropdown-messages-box">
                                    <a href="http://webapplayers.com/inspinia_admin-v2.1/profile.html"
                                       class="pull-left">
                                        <img alt="image" class="img-circle" src="../img/a4.jpg">
                                    </a>

                                    <div class="media-body ">
                                        <small class="pull-right text-navy">5h ago</small>
                                        <strong>Chris Johnatan Overtunk</strong> started following <strong>Monica
                                            Smith</strong>. <br>
                                        <small class="text-muted">Yesterday 1:21 pm - 11.06.2014</small>
                                    </div>
                                </div>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <div class="dropdown-messages-box">
                                    <a href="http://webapplayers.com/inspinia_admin-v2.1/profile.html"
                                       class="pull-left">
                                        <img alt="image" class="img-circle"
                                             src="../img/profile.jpg">
                                    </a>

                                    <div class="media-body ">
                                        <small class="pull-right">23h ago</small>
                                        <strong>Monica Smith</strong> love <strong>Kim Smith</strong>. <br>
                                        <small class="text-muted">2 days ago at 2:30 am - 11.06.2014</small>
                                    </div>
                                </div>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <div class="text-center link-block">
                                    <a href="http://webapplayers.com/inspinia_admin-v2.1/mailbox.html">
                                        <i class="fa fa-envelope"></i> <strong>Read All Messages</strong>
                                    </a>
                                </div>
                            </li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a class="dropdown-toggle count-info" data-toggle="dropdown"
                           href="http://webapplayers.com/inspinia_admin-v2.1/#">
                            <i class="fa fa-bell"></i> <span class="label label-primary">8</span>
                        </a>
                        <ul class="dropdown-menu dropdown-alerts">
                            <li>
                                <a href="http://webapplayers.com/inspinia_admin-v2.1/mailbox.html">
                                    <div>
                                        <i class="fa fa-envelope fa-fw"></i> You have 16 messages
                                        <span class="pull-right text-muted small">4 minutes ago</span>
                                    </div>
                                </a>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <a href="http://webapplayers.com/inspinia_admin-v2.1/profile.html">
                                    <div>
                                        <i class="fa fa-twitter fa-fw"></i> 3 New Followers
                                        <span class="pull-right text-muted small">12 minutes ago</span>
                                    </div>
                                </a>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <a href="http://webapplayers.com/inspinia_admin-v2.1/grid_options.html">
                                    <div>
                                        <i class="fa fa-upload fa-fw"></i> Server Rebooted
                                        <span class="pull-right text-muted small">4 minutes ago</span>
                                    </div>
                                </a>
                            </li>
                            <li class="divider"></li>
                            <li>
                                <div class="text-center link-block">
                                    <a href="http://webapplayers.com/inspinia_admin-v2.1/notifications.html">
                                        <strong>See All Alerts</strong>
                                        <i class="fa fa-angle-right"></i>
                                    </a>
                                </div>
                            </li>
                        </ul>
                    </li>


                    <li>
                        <a href="logout">
                            <i class="fa fa-sign-out"></i> Log out
                        </a>
                    </li>
                    <li>
                        <a class="right-sidebar-toggle">
                            <i class="fa fa-tasks"></i>
                        </a>
                    </li>
                </ul>

            </nav>
        </div>

        <div class="row wrapper border-bottom white-bg page-heading">
            <div class="col-lg-10">
                <h2>Settings</h2>
                <ol class="breadcrumb">
                    <li>
                        <a href="./">Home</a>
                    </li>
                    <li class="active">
                        <strong>File Manage</strong>
                    </li>
                </ol>
            </div>
            <div class="col-lg-2">
            </div>
        </div>

        <div class="wrapper wrapper-content fadeInRight" >
            <div class="row">
                <div class="col-lg-3">
                    <div class="ibox float-e-margins">
                        <div class="ibox-content">
                            <div class="file-manager">
                                <h5>Folders</h5>
                                <ul class="folder-list" style="padding: 0">
                                    <% fileInfo.forEach(function (item) { %>
                                    <li><a href=""><i class="fa fa-folder"></i> <%= item %></a></li>
                                    <% }) %>
                                </ul>
                                <div class="clearfix"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-lg-9 animated fadeInRight">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="ibox-title">
                                <div class="row">
                                    <div class="col-lg-3">
                                        <h5>Files List<small></small></h5>
                                    </div>
                                    <div class="col-lg-9">
                                        <div class="ibox-tools-btn">
                                            <a class="btn  btn-primary" data-toggle="modal" data-target="#fileUpload">
                                                <i class="fa fa-upload"></i> Upload File
                                            </a>

                                            <a class="btn  btn-primary" id="btn-select-all">
                                                Select All
                                            </a>
                                            <a class="btn  btn-primary" id="btn-select-cancel">
                                                Cancel Select
                                            </a>

                                            <a class="btn  btn-warning" id="btn-file-del">
                                                <i class="fa fa-trash-o"></i> Del Select
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="ibox-content"  id="list-files" style="overflow: hidden">

                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal inmodal fade" id="fileUpload" tabindex="-1" role="dialog"  aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title">File Upload</h4>
            </div>



            <form role="form" action="/upload" method="post" id="fileUploadForm"  enctype="multipart/form-data" target="hidden_frame">
                <div class="modal-body">
                    <div class="alert alert-warning alert-dismissable">
                        <button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button>
                        <span>支持JPG,JPEG,GIF,BMP,SWF,RMVB,RM,AVI文件的上传,文件大小小雨10MB</span>
                    </div>
                    <div class="form-group"><label>file path</label> <input type="file" name="file" placeholder="File name" class="form-control"></div>
                    <div class="form-group">
                        <label>upload path</label>
                        <select  name="src" class="form-control">
                            <option value="images" selected>images</option>
                            <option value="video">video</option>
                            <option value="audio">audio</option>
                        </select>
                        <iframe name="hidden_frame" id="hidden_frame" style="display:none"></iframe>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-white" data-dismiss="modal">Close</button>
                    <input type="submit" class="btn btn-primary" id="file_upload" value="Upload"/>
                </div>
            </form>
        </div>
    </div>
</div>
<script type="text/javascript">

    //upload callback
    function submitCb(type,msg,path){
        var alert =  $("#fileUploadForm .modal-body");
        if(type ==  "eror") {
            toastr.error('Upload Fail!');
        }
        else {
            toastr.success('Upload Success!');
        };
        $(".folder-list a:contains('" +path +"')").eq(0).click();
    }


    $(function(){

        //upload file form
        var formHtml = '<div class="alert alert-warning alert-dismissable"> <button aria-hidden="true" data-dismiss="alert" class="close" type="button">×</button> <span>支持JPG,JPEG,GIF,BMP,SWF,RMVB,RM,AVI文件的上传,文件小于10MB</span> </div> <div class="form-group"><label>file path</label> <input type="file" name="file" placeholder="File name" class="form-control"></div> <div class="form-group"> <label>upload path</label> <select name="src" class="form-control"> <option value="images" selected>images</option> <option value="video">video</option> <option value="audio">audio</option> </select> <iframe name="hidden_frame" id="hidden_frame" style="display:none"></iframe> </div>';
        $('#fileUpload').on('show.bs.modal', function (e) {
            $(this).find(".modal-body").html(formHtml)
        });

        $(".folder-list a").click(function(){
            var path = $.trim($(this).text());
            $.ajax({
                url: "/file/" + path,
                type: 'GET',
                success: function(data){
                    var html = "";
                    if(!isEmptyValue(data.fileInfo)) {
                        $.each(data.fileInfo,function(i,v){
                            html  +=  '<div class="file-box" title="' + v.name +'">' +'<div class="file"><span class="badge badge-success badge-select">selected</span>' + '<a href="javascript:void(0)">' + '<span class="corner"></span>' ;
                            if(v["type"] == "file") {
                                html += '<div class="icon">' + '<i class="fa fa-file"></i>' + '</div>' ;
                            } else {
                                html += '<div class="image"><img alt="image" class="img-responsive" src="' + v.path.split("public")[1] + '"></div>'
                            }
                            html += '<div class="file-name"><p class="name" >Name:' + v.name + '</p><p class="size">Size: ' + v.size + '</p><p class="time">Time: ' + v.time + '</p></div></a></div></div>';
                        });
                    } else {
                        html = '<div class=" text-center animated fadeInDown" style="padding:50px 0;"> <h3>File List Empty!!!</h3> </div>'
                    }


                    $("#list-files").attr({"path" : path }).html(html);
                    $("#list-files").prev().find("h5").html(path +" Files List");
                    $('#list-files .file-box').each(function() {
                        animationHover(this, 'pulse');
                    });
                    $(".folder-list li").removeClass("cur");
                    $(".folder-list li:contains('" +path +"')").addClass("cur");
                    $('#fileUpload').modal('hide');

                },
                error: function(xmlHTTPRequest, status, error){
                    console.log(status);
                }
            })
            return false;
        });

        //del file
        $("#btn-file-del").click(function(){
            var delList = [],path = $("#list-files").attr("path");
            $(".file-box:has('.selected')").each(function(){
                delList.push($(this).attr("title"));
            });
            if(delList.length == 0) return;
            $.ajax({
                url: "/fileDel",
                type: 'POST',
                data: {delList : delList,delFilePath : path},
                success: function(data){
                    $(".folder-list a:contains('" +path +"')").eq(0).click();
                    toastr.success('Del Success!');
                },
                error: function(error){
                    toastr.error('Del Error!')
                }
            })
            return false;
        });

        $(".folder-list a").eq(0).click();

        $("#btn-select-all").click(function(){
            $('#list-files  .file').addClass("selected");
        });
        $("#btn-select-cancel").click(function(){
            $('#list-files  .file').removeClass("selected");
        });
        $('#list-files').delegate(" .file", "click",function(){
            $(this).toggleClass("selected");
        });


    })
</script>



<%- include footer %>
